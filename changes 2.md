# Changes Log

- 2025-12-24: Created `changes.md` to record all subsequent modifications. Added `README.md` with a deployment template; awaiting project details to fill in specific steps.
- 2025-12-24: Added `docs/architecture.md` documenting stack choices (Node.js 20 + TypeScript + Fastify, Postgres + Prisma, Redis + BullMQ), tenancy model, plugin approach, and near-term steps.
- 2025-12-24: Updated `README.md` with concrete stack prerequisites and pending setup/deployment notes aligned to the chosen architecture.
- 2025-12-24: Initialized Next.js (App Router) backend scaffold with pnpm, TypeScript, Prisma, and Auth.js credentials provider. Added multi-tenant Prisma schema, RBAC helpers, health/me APIs, and Stripe checkout endpoint. Added env example and updated README with setup/run/deployment steps.
- 2025-12-24: Updated `docs/architecture.md` to reflect the Next.js API-hosting approach, current tenancy model, and next steps.
- 2025-12-24: Added `.gitignore` entry for `.DS_Store`.
- 2025-12-24: Expanded Prisma schema with domain models (products, inventory, orders/lines, plugins/installations, jobs, tickets) including tenant scoping and enums. Generated initial SQL migration at `prisma/migrations/0001_init.sql` via `prisma migrate diff`.
- 2025-12-24: Installed dependencies locally (`npx pnpm install`), generated Prisma client (`npx pnpm exec prisma generate`), and added a development `.env` with local Postgres/Stripe/Auth settings.
- 2025-12-24: Installed PostgreSQL 14 locally via Homebrew, started the service (`brew services start postgresql@14`), and created superuser `postgres` plus database `yentral`.
- 2025-12-24: Replaced manual diff with Prisma-managed migration `prisma/migrations/20251224130947_init/migration.sql` (lockfile added) and applied it to the local database using `npx pnpm prisma migrate dev --name init`.
- 2025-12-24: Added `docker-compose.yml` (Postgres 14 + Redis 7) for local services and updated `.env.example` with `REDIS_URL`.
- 2025-12-24: Added Prisma seed (`prisma/seed.js`), wired `db:seed` script and Prisma seed hook in `package.json`, and seeded demo data (tenant demo; user admin@yentral.test / changeme123; sample product, order, plugin install, job, ticket).
- 2025-12-24: Integrated pg-boss job engine with worker script (`scripts/boss-worker.ts`), processors for `sync.job`, `email.ingest`, and `sla.monitor`, and added job monitoring table `JobRun` with Prisma migration `20251224133138_add_job_runs`. Updated README and env defaults, added pg-boss dependencies, and extended seed to record a job run.
- 2025-12-24: Added channel plugin contract (`src/plugins/channel-plugin.ts`), plugin registry (`src/plugins/registry.ts`), and plugin helper (`src/lib/plugins.ts`). Extended Prisma Plugin model with registry fields and migration `20251224133527_plugin_registry_fields`. Implemented marketplace install API (`/api/plugins/install`) with RBAC and config validation; documented jobs/APIs in README; reseeded demo data.
- 2025-12-24: Implemented support foundations: added IMAP/SMTP envs and mail helpers, extended Ticket with SLA fields (migration `20251224134103_ticket_sla_fields`), enhanced pg-boss processors for email ingest/auto-reply and SLA monitoring, added tickets UI at `/tickets`, and updated README. Reseeded demo data.
- 2025-12-24: Added repository layer (`src/repositories/*`) for products, warehouses/inventory, orders, integration connections, jobs, and tickets with tenant-scoped CRUD/query helpers.
- 2025-12-24: Added service layer (`src/services/*`) with business rules and event stubs for products, inventory, orders, integrations, jobs, and tickets. Implemented a simple Postgres job engine (`src/lib/jobEngine.ts`) with claim/run/retry/dead-letter handling and backoff.
- 2025-12-24: Added product API routes (`/api/products`, `/api/products/[id]`) using ProductService with tenant isolation and validation.
- 2025-12-24: Added integration API routes (`/api/connectors`, `/api/connections`, `/api/connections/[id]`, `/api/connections/[id]/test`) using IntegrationService/Repo and tenant isolation.
- 2025-12-24: Added job API routes (`/api/jobs`, `/api/jobs/[id]`, `/api/jobs/[id]/retry`, `/api/jobs/[id]/cancel`) using JobService/Repo with tenant isolation.
- 2025-12-24: Added support API routes (`/api/tickets`, `/api/tickets/[id]`, `/api/tickets/[id]/reply`, `/api/tickets/[id]/assign`) using TicketService with tenant isolation.
- 2025-12-24: Expanded schema with jurisdictions, organizations, legal entities, tax profiles, warehouses, connectors/versions; added migration `20251224141829_add_jurisdictions_legal_entities`. Updated seed to create tenant/org, international jurisdictions (EU/US/UK + EU countries + US states), legal entities, tax profiles, warehouses, connectors, and admin membership.
- 2025-12-24: Added state check tooling: package scripts (`db:status`, `db:validate`, `db:generate`, `state:check`), script `scripts/state-check.ts`, and README instructions.
